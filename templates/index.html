<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title></title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body {
				background: #0c0c0c;
				color: #00ff00;
				font-family: 'Courier New', monospace;
				font-size: 16px;
				padding: 20px;
				min-height: 300vh;
			}
			.terminal {
				max-width: 1200px;
				margin: 0 auto;
				background: #1a1a1a;
				border: 2px solid #00ff00;
				border-radius: 5px;
				padding: 20px;
				box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
			}
			.header {
				color: #00ff00;
				margin-bottom: 20px;
				padding-bottom: 10px;
				border-bottom: 1px solid #00ff00;
			}
			.header h1 {
				font-size:24px;
				margin-bottom: 5px;
			}
			.header .subtitle {
				font-size:14px;
				color: #00aa00;
			}
			.display {
				margin-bottom: 20px;
				min-height: 500px;
				overflow-y: auto;
				overflow-x: hidden;
				height: 500px;
			}
			.display-line {
				margin-bottom: 10px;
			}
			.command {
				color: #00ff00;
			}
			.input-line {
				display: flex;
				align-items: center;
			}
			.prompt {
				color: #00ff00;
				margin-right: 10px;
			}
			#command-input {
				flex: 1;
				background: transparent;
				border: none;
				color: #ffffff;
				font-family: 'Courier New', monospace;
				font-size: 18px;
				outline: none;
				caret-color: transparent;
				z-index: 1;
				position: relative;
				outline: none;
			}
			
			@keyframes blink {
				0%, 49% { opacity: 1;}
				50%, 100% { opacity: 0;}
			}
			
			.result {
				color: #00dd00;
				margin-left: 20px;
				white-space: pre-wrap;
			}
			.result.error {
				color: #ff6b6b;
				white-space: pre-wrap;
			}
			.cursor {
				display: inline-block;
				position: absolute;
				width: 8px;
				height: 16px;
				background: #00ff00;
				animation: blink 1s infinite;
				pointer-events: none;
			}
			.hint {
				color: #666;
				font-size: 16px;
				margin-top: 10px;
			}
			.success {
				color: #00ffff;
			}
			.loading {
				color: #ffff00;
			}
		</style>
	</head>
	<body>
		<div class="terminal">
			<!-- header -->
			<div class="header">
				<h1> ARUN RAGHUNATH - Devops/ Engineering Manager Portfolio </h1>
				<div class="subtitle">Type "help" to get started | Use ↑↓ arrows for history
				</div>
			</div>

			<!-- output area - command results and history is displayed here -->

			<div class="display" id="display">
			
			</div>
			<!-- terminal input where users can type -->
			<div class="input-line">
				<span class="prompt" id="prompt"> visitor@portfolio:~$</span>
				<input type="text" id="command-input" autofocus></input>
				<span class="cursor" id="cursor"></span>
			</div>
				
			</div>
		</div>
		<script>

			const state = {
				cmdHistory: [],
				historyIndex: -1,
				isProcessing: false,
				projectsCache: null
			}

			const staticCommands = {
				help: {
					description: `show available commands`,
					execute: () => {
						return `\nAvailable commands: 
															
  help 		- Show this help message
  about		- A brief about me
  projects	- A list of projects am working on
  skills	- Summary of the technologies I am proficient on
  contact	- Contact information
  clear		- Clear the terminal
  
tip: use ↑↓ arrows to navigate command  history!`
					}
					
				},
				about : {
					description: `about me`,
					execute: () => {
						return `\nAbout ARUN RAGHUNATH
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Engineering Manager | 10+ years IT experience

Currently on a career break, studying computer science fundamentals.
Building hands-on projects and learning by doing.

Goal: Cloud Architect/ Engineering Manager roles
Philosophy: Learn by building, understand by reading source code.`;
					}
				},
				skills : {
					description: `I am a software developer`,
					execute: () => {
						return `\nTechnical Skills: 
Core:
	• Python (Flask)
	• Docker & Containerization
	• Git version control

Learning:
	• System Design
	• Networking
	• Go Programming
	`;
					}
				},
				clear : {
					description: ``,
					execute: () => {
						display.innerHTML = '';
						return null;
					}
				},
				history : {
					description: `show command history`,
					execute: () => {
						if (state.cmdHistory.length == 0) {
							return `\nNo commands in history yet.`;
						}
						let result = "\nCommand History\n\n";
						state.cmdHistory.forEach((cmd, index) => {
							result += `${index +1}. ${cmd}\n`;
						})
						return result;
					}
				}
			}
			const display = document.getElementById("display")
			const userinput = document.getElementById("command-input")

			function printDisplay(cmd, result, isError=false, isLoading=false) {
				if (cmd === null) {
					return ;
				}
				const div = document.createElement('div');
				div.className = 'display-line';

				if (cmd) {
					const cmdDiv = document.createElement('div');
					cmdDiv.className = 'command';
					cmdDiv.textContent = 'visitor@portfolio:~$ ' + cmd;
					div.appendChild(cmdDiv);
				}
				
				
				const resultDiv = document.createElement('div');
				if (isError) {
					resultDiv.className = 'result error';
				} else if (isLoading) {
					resultDiv.className = 'result loading';
				} else {
					resultDiv.className = 'result';
				}
				
				resultDiv.textContent = result;
				div.appendChild(resultDiv);

				display.appendChild(div);
				display.scrollTop = display.scrollHeight;
				requestAnimationFrame(() => {
				        display.scrollTop = display.scrollHeight;
				    });
				
			}
			
			async function processCommand(cmd) {
				cmd = cmd.trim();
				if (!cmd) return;

				if (state.isProcessing) {
					printDisplay('', 'Please wait for the current command to complete...', true);
				}

				if (cmd != "history") {
					state.cmdHistory.push(cmd);
					state.historyIndex = state.cmdHistory.length;
				}
				
				if (staticCommands[cmd]) {
					const result = staticCommands[cmd].execute();
					printDisplay(cmd, result, false);
			
				} else if (cmd == "projects") {
					await fetchProjects(cmd);
					return;
				} else {
					printDisplay(cmd, `Command not found: ${cmd}
Type 'help' to see available commands!
										`, true);
					
				}
				if (cmd == "history") {
					state.cmdHistory.push(cmd);
					state.historyIndex = state.cmdHistory.length;
				}
			}

			async function fetchProjects(cmd) {
				state.isProcessing = true;
				userinput.disabled = true;
				try {
					const response = await fetch ('/api/command', {
						method: 'POST',
						headers: {
							'Content-Type' : 'application/json'
						},
						body: JSON.stringify({
							command: cmd
						}) 
					});
					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}
					const data = await response.json();
					formatted_projects = formatProjects(data);
					printDisplay(cmd, formatted_projects, false);
				} catch (error) {
					
				} finally {
					state.isProcessing = false;
					userinput.disabled = false;
					userinput.focus();
				}
			}

			function formatProjects(data) {
				let result = `\nMy projects (total ${data.count} )\n\n`;
				data.projects.forEach((project, index) => {
					result += `${index +1}. ${project.name}\n`;
					result += `${project.description}\n`;
					result += `Tech: ${project.tech.join(', ')}\n`;
					result += `Github: ${project.github}\n`;
				})
				return result;
			}
			
			function navigateHistory(direction) {
				if (state.cmdHistory.length == 0){
					return;
				}

				if (direction == 'up') {
					if (state.historyIndex > 0) {
						state.historyIndex--;
						userinput.value = state.cmdHistory[state.historyIndex];
					}
				} else if (direction == 'down') {
					if (state.historyIndex < state.cmdHistory.length -1) {
						state.historyIndex++;
						userinput.value = state.cmdHistory[state.historyIndex];
					} else {
						state.historyIndex = state.cmdHistory.length;
						userinput.value = '';
					}
				}
			}

			document.addEventListener('click', function(){
				userinput.focus();
			});

			userinput.addEventListener('keydown', function(event){
				if (event.key == 'Enter') {
					const cmd = userinput.value;
					processCommand(cmd);
					userinput.value = '';
				} else if (event.key == 'ArrowUp') {
					event.preventDefault();
					navigateHistory('up');
				} else if (event.key == 'ArrowDown') {
					event.preventDefault();
					navigateHistory('down');
				}
			});
			window.addEventListener('load', function() {
				const welcomeText = `Welcome to Arun Raghunath's portfolio!
				
Type 'help' to see what you can do.`;
				printDisplay('', welcomeText, false);
			});

			const prompt = document.getElementById('prompt');
			const cmdinput = document.getElementById('command-input');
			const cursor = document.getElementById('cursor');
			cmdinput.style.caretColor = 'transparent';
			cmdinput.addEventListener('input', positionCursor);
			cmdinput.addEventListener('click', positionCursor);
			cmdinput.addEventListener('keyup', positionCursor);
				
			function positionCursor() {
				const span = document.createElement('span');
				span.style.font = window.getComputedStyle(cmdinput).font;
				span.style.visibility = 'hidden';
				span.textContent = prompt.textContent + cmdinput.value;
				document.body.appendChild(span);
				const textWidth = span.offsetWidth;
				document.body.removeChild(span);

				cursor.style.marginLeft = textWidth + 'px';
			}

			positionCursor();
		</script>
	</body>
</html>
